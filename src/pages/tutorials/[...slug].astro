---
import { getCollection } from "astro:content";
import Layout from "~/layouts/PageLayout.astro";
import Image from "~/components/common/Image.astro";

export async function getStaticPaths() {
    const products = await getCollection("products");
    return products.map((product) => ({
        params: { slug: product.slug },
        props: { product },
    }));
}

const { product } = Astro.props;
const { Content } = await product.render();

const metadata = {
    title: product.data.title,
    description: product.data.description,
};
---

<Layout metadata={metadata}>
    <section class="py-8 sm:py-16 lg:py-20 mx-auto">
        <div class="max-w-4xl mx-auto px-4 sm:px-6">
            <div class="max-w-3xl mx-auto">
                <div class="mb-8">
                    {
                        product.data.image && (
                            <Image
                                src={product.data.image}
                                class="mx-auto rounded-lg shadow-lg bg-gray-400 dark:bg-slate-700 w-full"
                                widths={[400, 900]}
                                alt={product.data.title}
                            />
                        )
                    }
                </div>

                <h1
                    class="px-4 text-4xl sm:text-5xl font-bold leading-tight tracking-tighter mb-4 font-heading dark:text-gray-200"
                >
                    {product.data.title}
                </h1>

                <div class="px-4 text-2xl font-bold text-primary mb-8">
                    价格: ¥{product.data.price}
                </div>

                <div
                    class="px-4 prose prose-lg prose-md prose-headings:font-heading prose-a:text-primary dark:prose-invert max-w-none"
                >
                    <Content />
                </div>

                <div
                    class="mt-12 p-6 bg-blue-50 dark:bg-slate-800 rounded-lg border border-blue-100 dark:border-slate-700"
                >
                    <h3 class="text-2xl font-bold mb-4">如何购买？</h3>
                    <div class="flex flex-col md:flex-row gap-8 items-center">
                        <div class="flex-1">
                            <p class="mb-4 text-lg">
                                只要 <strong>¥{product.data.price}</strong
                                >，即可获取本教程。
                            </p>
                            <p class="mb-2">请扫描右侧二维码支付，并备注：</p>
                            <ul
                                class="list-disc list-inside mb-4 font-bold text-gray-700 dark:text-gray-300"
                            >
                                <li>您的邮箱地址</li>
                                <li>教程名称：{product.data.title}</li>
                            </ul>
                            <p class="text-sm text-gray-500">
                                支付成功后，我们将在 24
                                小时内将教程发送至您的邮箱。
                            </p>
                        </div>
                        <!-- 这里展示您的二维码，暂时使用占位图 -->
                        <div
                            class="w-48 h-48 bg-white p-2 rounded shadow-sm shrink-0"
                        >
                            {
                                /* TODO: 替换为您真实的二维码图片路径, 例如 ~/assets/images/qr-code.jpg */
                            }
                            <Image
                                src="~/assets/images/default.png"
                                class="w-full h-full object-contain"
                                widths={[200]}
                                alt="扫码支付"
                            />
                            <p class="text-center text-xs mt-1 text-gray-500">
                                微信/支付宝扫码
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</Layout>
